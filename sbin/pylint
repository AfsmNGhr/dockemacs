#!/usr/bin/env sh

# args :
#
#   --reports\=n --output-format\=text \
#   --msg-template\=\{path\}:\{line\}:\{column\}:\{C\}:\{symbol\}:\{msg\} \
#   --rcfile\=/local/path/.pylintrc /local/path/*.py
#
#   Works: with python 3.7 and pylint==1.9.3

cmd="$PROJECT_PYLINT_CMD"

for i in "$@"; do
    case "$i" in
        *\'*)
            i=$(printf "%s" "$i")
            ;;
        *$PROJECT_LOCAL_PATH*)
            i=$(printf "%s" "$i" | \
                    sed -e "s|$PROJECT_LOCAL_PATH|$PROJECT_REMOTE_PATH|g")
            ;;
        *=*)
            i=$(printf "%s" "$i" | sed -e "s/=\(.*\)/=\"\1\"/g")
            ;;
        *) : ;;
    esac
    cmd="$cmd $i"
done

ssh "$HOST_USER@$HOST_IP" -p "$HOST_PORT" -tt "$cmd" > /tmp/pylint.out

if [ -n "$DEBUG" ]; then
    printf "DEBUG: You may test it with below command\nCMD: $cmd\n"
    printf "FULL: ssh \"$HOST_USER@$HOST_IP\" -p \"$HOST_PORT\" -tt %s" "$cmd"
fi

cat /tmp/pylint.out

exit 0
