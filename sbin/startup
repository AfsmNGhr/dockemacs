#!/usr/bin/env sh

ln -s "$WORKSPACE/.gitconfig" "$HOME/.gitconfig"
ln -s "$WORKSPACE/.ssh" "$HOME/.ssh"
ln -s "$WORKSPACE/.gnupg" "$HOME/.gnupg"

cd "$HOME/.emacs.d"

if [ ! -d "$HOME/.emacs.d/.git" ]; then
   git init
   git remote add origin "$REPOSITORY"
fi

(git fetch origin "$BRANCH" || true)

if [ -n "$HEAD_FORCE" ]; then
    git reset --hard origin/"$BRANCH"
fi

if [ -f "$HOME/.emacs.d/init.org" ]; then
    literate
fi

export ORG_PATH="$WORKSPACE/$ORG_FILES"
cd "$WORKSPACE"
emacs
