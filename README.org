#+OPTIONS: toc:2

** Dockemacs - the minimal emacs noX
[[https://coveralls.io/github/AfsmNGhr/dockemacs?branch=master][https://coveralls.io/repos/github/AfsmNGhr/dockemacs/badge.svg?branch=master]]
[[https://travis-ci.org/AfsmNGhr/dockemacs][https://travis-ci.org/AfsmNGhr/dockemacs.svg?branch=master]]
[[https://microbadger.com/images/afsmnghr/dockemacs][https://images.microbadger.com/badges/version/afsmnghr/dockemacs.svg]]
[[https://microbadger.com/images/afsmnghr/dockemacs][https://images.microbadger.com/badges/image/afsmnghr/dockemacs.svg]]
[[https://hub.docker.com/r/afsmnghr/dockemacs/][https://img.shields.io/docker/pulls/afsmnghr/dockemacs.svg?style=flat-square]]
[[https://hub.docker.com/r/afsmnghr/dockemacs/][https://img.shields.io/docker/stars/afsmnghr/dockemacs.svg?style=flat-square]]

[[https://i.imgur.com/LZxhWdm.png]]

*** Installing
- [[https://docs.docker.com/engine/installation/][Install Docker Engine]]:
- Create emacs data volume:

  #+begin_src sh :tangle no
docker volume create emacs_data
  #+end_src

- Add alias:

  #+begin_src sh :tangle no
echo "alias dockemacs=\"
  docker run -it --rm --net=host \
       --env-file $HOME/.dockemacs \
       --entrypoint initialize \"$@\" \
       -v $HOME:/mnt/workspace \
       -v emacs_data:/home/emacser/.emacs.d \
       -v /etc/localtime:/etc/localtime:ro \
       afsmnghr/dockemacs:1.7.0 startup
  \"" "$HOME/.bash_aliases"
  #+end_src

- Prepare =$HOME/.dockemacs=, check your =env=:

  #+begin_src sh :tangle no
  echo "UID=$(id -u)" >> $HOME/.dockemacs
  echo "GID=$(id -g)" >> $HOME/.dockemacs
  echo "UNAME=emacser" >> $HOME/.dockemacs
  echo "GNAME=emacs" >> $HOME/.dockemacs
  echo "HOME=/home/emacser" >> $HOME/.dockemacs
  echo "WORKSPACE=/mnt/workspace" >> $HOME/.dockemacs
  echo "SHELL=/bin/bash" >> $HOME/.dockemacs
  echo "TERM=xterm-256color" >> $HOME/.dockemacs
  echo "ORG_FILES=Documents/org/" >> $HOME/.dockemacs
  echo "HOST_USER=afsmnghr" >> $HOME/.dockemacs
  echo "HOST_IP=127.1" >> $HOME/.dockemacs # only work with --net=host
  echo "HOST_PORT=22" >> $HOME/.dockemacs
  echo "DISPLAY=:0.0" >> $HOME/.dockemacs
  echo "WEB_BROWSER=chromium" >> $HOME/.dockemacs
  echo "REPOSITORY=git@github.com:AfsmNGhr/dockemacs.git" >> $HOME/.dockemacs
  #+end_src

    * =UID= and =GID= - transparent permissions
    * =UNAME= and =GNAME= - user & group name in container
    * =HOME= - rewrite home path for new user
    * =WORKSPACE= - mount path from host
    * =SHELL= - default shell
    * =TERM= - set terminal env
    * =ORG_FILES= - only relative path
    * =HOST_USER=, =HOST_IP=, =HOST_PORT= - remote management through ssh
    * =DISPLAY= - for GUI application
    * =WEB_BROWSER= - setup browser for emacs
    * =REPOSITORY= - our repository dotemacs (first clone)

- Setup ssh daemon and restart:

  #+begin_src sh :tangle no
# /etc/ssh/sshd_config

ListenAddress 127.1
  #+end_src

- Add SSH Keys to authorized_keys:

  #+begin_src sh :tangle no
ssh-copy-id "$HOST_USER@$HOST_IP" -p "$HOST_PORT"
  #+end_src

- Run and wait until the boot:

  #+begin_src sh :tangle no
$ dockemacs
  #+end_src
