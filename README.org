** Dockemacs - the minimal emacs noX
[[https://coveralls.io/github/AfsmNGhr/dockemacs?branch=master][https://coveralls.io/repos/github/AfsmNGhr/dockemacs/badge.svg?branch=master]]
[[https://travis-ci.org/AfsmNGhr/dockemacs][https://travis-ci.org/AfsmNGhr/dockemacs.svg?branch=master]]
[[https://microbadger.com/images/afsmnghr/dockemacs][https://images.microbadger.com/badges/version/afsmnghr/dockemacs.svg]]
[[https://microbadger.com/images/afsmnghr/dockemacs][https://images.microbadger.com/badges/image/afsmnghr/dockemacs.svg]]
[[https://hub.docker.com/r/afsmnghr/dockemacs/][https://img.shields.io/docker/pulls/afsmnghr/dockemacs.svg?style=flat-square]]
[[https://hub.docker.com/r/afsmnghr/dockemacs/][https://img.shields.io/docker/stars/afsmnghr/dockemacs.svg?style=flat-square]]

[[https://i.imgur.com/wmDvJbq.png?1]]

*** Table of Contents                                                 :TOC:
- [[#installation][Installation]]
  - [[#install-docker-engine][Install Docker Engine]]
  - [[#add-alias][Alias]]
  - [[#prepare-homedockemacs-check-your-env][Prepare variables]]
  - [[#setup-ssh-daemon-and-restart][Setup ssh daemon]]
  - [[#add-ssh-keys-to-authorized_keys][Ssh Keys]]
  - [[#run-and-wait-until-the-boot][Run]]
- [[#themes][Themes]]
  - [[#spolsky][Spolsky]]
  - [[#spolsky-term][Spolsky Term]]
- [[#wrappers-for-container-workflow][Wrappers]]
  - Web browser
  - Docker
  - [[#bundle][Bundle]]
  - [[#rubocop][Rubocop]]
  - [[#node][node]]
  - [[#tslint][tslint]]
  - [[#pylint][Pylint]]
- [[#configurations][Configurations]]
  - [[#initialize][Initialize]]
  - [[#package-management][Package Management]] (use-package)
  - [[#encoding][Encoding]]
  - [[#indentation][Indentation]]
  - [[#interface][Interface]]

*** Installation

**** [[https://docs.docker.com/engine/installation/][Install Docker Engine]]:
**** Create emacs data volume:

#+begin_src sh :tangle no
docker volume create emacs_data
#+end_src

**** Add alias:

#+begin_src sh :tangle no
# ~/.bash_aliases or etc ...

alias dockemacs='
  docker run -it --rm --net=host \
       --env-file $HOME/.dockemacs \
       --entrypoint initialize "$@" \
       -v $HOME:/mnt/workspace \
       -v emacs_data:/home/emacser/.emacs.d \
       -v /etc/localtime:/etc/localtime:ro \
       afsmnghr/dockemacs:1.7.0 startup
'
#+end_src

**** Prepare =$HOME/.dockemacs=, check your =env=:

#+begin_src sh :tangle no
  echo "UID=$(id -u)" >> $HOME/.dockemacs
  echo "GID=$(id -g)" >> $HOME/.dockemacs
  echo "UNAME=emacser" >> $HOME/.dockemacs
  echo "GNAME=emacs" >> $HOME/.dockemacs
  echo "HOME=/home/emacser" >> $HOME/.dockemacs
  echo "WORKSPACE=/mnt/workspace" >> $HOME/.dockemacs
  echo "SHELL=/bin/bash" >> $HOME/.dockemacs
  echo "TERM=xterm-256color" >> $HOME/.dockemacs
  echo "ORG_FILES=Documents/org/" >> $HOME/.dockemacs
  echo "HOST_USER=afsmnghr" >> $HOME/.dockemacs
  echo "HOST_IP=127.1" >> $HOME/.dockemacs # only work with --net=host
  echo "HOST_PORT=22" >> $HOME/.dockemacs
  echo "DISPLAY=:0.0" >> $HOME/.dockemacs
  echo "WEB_BROWSER=chromium" >> $HOME/.dockemacs
  echo "REPOSITORY=git@github.com:AfsmNGhr/dockemacs.git" >> $HOME/.dockemacs
#+end_src

    * =UID= and =GID= - transparent permissions
    * =UNAME= and =GNAME= - user & group name in container
    * =HOME= - rewrite home path for new user
    * =WORKSPACE= - mount path from host
    * =SHELL= - default shell
    * =TERM= - set terminal env
    * =ORG_FILES= - only relative path
    * =HOST_USER=, =HOST_IP=, =HOST_PORT= - remote management through ssh
    * =DISPLAY= - for GUI application
    * =WEB_BROWSER= - setup browser for emacs
    * =REPOSITORY= - our repository dotemacs (first clone)

**** Setup ssh daemon and restart:

#+begin_src sh :tangle no
# /etc/ssh/sshd_config

ListenAddress 127.1
#+end_src

**** Add SSH Keys to authorized_keys:

#+begin_src sh :tangle no
ssh-copy-id "$HOST_USER@$HOST_IP" -p "$HOST_PORT"
#+end_src

**** Run and wait until the boot:

#+begin_src sh :tangle no
$ dockemacs
#+end_src

*** Themes

**** Spolsky

Dark color theme

[[file:images/spolsky-theme.png]]

**** Spolsky Term

Dark color theme for terminal

[[file:images/spolsky-term-theme.png]]

*** Wrappers for container workflow

- =WEB_BROWSER= from =env= with =DISPLAY=
- [[https://docs.docker.com/][Docker]]

**** [[http://bundler.io/][Bundle]]

#+begin_src elisp :tangle no
;; .dir-locals.el in root project

((nil . ((eval .
               (progn
                 (setenv "PROJECT_LOCAL_PATH" "/mnt/workspace/local/path")
                 ;; local path in dockemacs container
                 (setenv "PROJECT_REMOTE_PATH" "/remote/path")
                 ;; remote path in project container
                 (setenv "PROJECT_BUNDLE_CMD" "docker exec -it PROJECT_CONTAINER bundle"))))))
#+end_src

**** [[https://github.com/bbatsov/rubocop][Rubocop]]

#+begin_src elisp :tangle no
;; .dir-locals.el in root project

((nil . ((eval .
               (progn
                 (setenv "PROJECT_LOCAL_PATH" "/mnt/workspace/local/path")
                 ;; local path in dockemacs container
                 (setenv "PROJECT_REMOTE_PATH" "/remote/path")
                 ;; remote path in project container
                 (setenv "PROJECT_RUBOCOP_CMD" "docker exec -it PROJECT_CONTAINER rubocop"))))))
#+end_src

**** [[https://nodejs.org/][node]]

#+begin_src elisp :tangle no
;; .dir-locals.el in root project

((nil . ((eval .
               (progn
                 (setenv "PROJECT_LOCAL_PATH" "/mnt/workspace/local/path")
                 ;; local path in dockemacs container
                 (setenv "PROJECT_REMOTE_PATH" "/remote/path")
                 ;; remote path in project container
                 (setenv "PROJECT_NODE_CMD" "docker exec -it PROJECT_CONTAINER node"))))))
#+end_src

**** [[https://www.npmjs.com/package/tslint][tslint]]

#+begin_src elisp :tangle no
;; .dir-locals.el in root project

((nil . ((eval .
               (progn
                 (setenv "PROJECT_LOCAL_PATH" "/mnt/workspace/local/path")
                 ;; local path in dockemacs container
                 (setenv "PROJECT_REMOTE_PATH" "/remote/path")
                 ;; remote path in project container
                 (setenv "PROJECT_TSLINT_CMD" "docker exec -it PROJECT_CONTAINER tslint")
                 ;; container workflow
                 (setenv "PROJECT_TSLINT_CMD" "cd /remote/path && /$(npm bin)/tslint")
                 ;; host application
)))))
#+end_src

**** [[https://www.pylint.org/][Pylint]]

#+begin_src elisp :tangle no
;; .dir-locals.el in root project

((nil . ((eval .
               (progn
                 (setenv "PROJECT_LOCAL_PATH" "/mnt/workspace/local/path")
                 ;; local path in dockemacs container
                 (setenv "PROJECT_REMOTE_PATH" "/remote/path")
                 ;; remote path in project container
                 (setenv "PROJECT_PYLINT_CMD" "docker exec -it PROJECT_CONTAINER pylint"))))))
#+end_src

*** Configurations

**** Initialize

Set lexical scoping for the init-file.

#+begin_src elisp
;;; -*- lexical-binding: t -*-
#+end_src

**** Package Management

The =use-package= declarative and performance-oriented. Initialize the emacs packaging system and autoinstalling packages.

#+begin_src elisp
(require 'package)
(package-initialize)

(setq package-enable-at-startup nil
      package-archives '(("gnu" . "https://elpa.gnu.org/packages/")
                         ("org" . "http://orgmode.org/elpa/")
                         ("melpa" . "https://melpa.org/packages/")
                         ("melpa-stable" . "https://stable.melpa.org/packages/")))

(unless (version< emacs-version "25.1")
  (setq package-archive-priorities '(("melpa-stable" . 10)
                                     ("gnu" . 10)
                                     ("melpa" . 20))))
(unless package-archive-contents
  (package-refresh-contents))

(unless (package-installed-p 'use-package)
  (package-install 'use-package))

(eval-when-compile
  (require 'use-package))
(require 'diminish)
(require 'bind-key)

(setq use-package-verbose t
      use-package-always-ensure t)
#+end_src

**** Encoding

Set utf-8 everywhere.

#+begin_src elisp
(prefer-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(setq buffer-file-coding-system 'utf-8
      file-name-coding-system 'utf-8
      x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING))
#+end_src

**** Indentation

Prefer space indentation.

#+begin_src elisp
(setq tab-width 2
      tab-always-indent 'complete
      indent-tabs-mode nil)
#+end_src

**** Interface

Set custom file and few variables.

#+begin_src elisp
(setq custom-file (concat user-emacs-directory "custom.el")

(custom-set-variables
 '(whitespace-style '(face lines-tail))
 '(org-babel-load-languages
   (quote ((emacs-lisp . t) (sh . t) (ruby . t) (js . t))))
 '(org-confirm-babel-evaluate nil))

(custom-set-faces
 '(aw-leading-char-face
   ((t (:inherit ace-jump-face-foreground :height 3.0)))))
#+end_src

Answering yes or no short.

#+begin_src elisp
(fset 'yes-or-no-p 'y-or-n-p)
#+end_src

Clear UI.

#+begin_src elisp
(menu-bar-mode -1)
(if tool-bar-mode
    (tool-bar-mode -1))
(column-number-mode -1)
(blink-cursor-mode -1)
(line-number-mode -1)
(size-indication-mode -1)
#+end_src

Time in the modeline.

#+begin_src elisp
(display-time-mode)
(setq display-time-interval 1
      display-time-format "%H:%M")
#+end_src

Dialogs stay in emacs.

#+begin_src elisp
(setq use-dialog-box nil
      use-file-dialog nil
      epa-pinentry-mode 'loopback)
#+end_src

**** History

Write history.

#+begin_src elisp
(setq history-length t
      history-delete-duplicates t
      savehist-save-minibuffer-history 1
      savehist-autosave-interval 60
      savehist-additional-variables '(search-ring regexp-search-ring
                                                  comint-input-ring))

(savehist-mode 1)
#+end_src
