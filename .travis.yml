services:
  - docker

install:
  - docker build -t afsmnghr/emacs .

script:
  - docker run --rm -it afsmnghr/emacs \
    cd "$HOME/.emacs.d" && \
    git pull origin master && \
    (bundle check || bundle install --path "$HOME/.emacs.d/bundle") && \
    npm install && export PATH="$(npm bin):$PATH" && \
    emacs --version && ./test-startup
